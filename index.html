<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dibujo en Canvas</title>
    <style>
        #myCanvas {
            border: 1px solid #000000;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas" width="600" height="600"></canvas>
    <script type="text/javascript">
        const miCanvas = document.getElementById("myCanvas");
        const ctx = miCanvas.getContext("2d");

        const formas = []; 
        const puntos = [];
        let colorActual = obtenerColorAleatorio(); 
        let esCirculo = true; 
        let botonPresionado = false; // Variable para rastrear el estado del botón

        function obtenerColorAleatorio() {
            const letras = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letras[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        miCanvas.addEventListener("mousedown", function (evento) {
            const rect = miCanvas.getBoundingClientRect();
            const x = evento.clientX - rect.left;
            const y = evento.clientY - rect.top;
            const tamaño = 80;

            formas.push({ x, y, tamaño, color: colorActual, esCirculo });
            dibujarCanvas();
            
            botonPresionado = true; 
        });

        miCanvas.addEventListener("mouseup", function () {
            botonPresionado = false; 
        });

        miCanvas.addEventListener("mouseout", function () {
            colorActual = obtenerColorAleatorio(); 
            esCirculo = !esCirculo; 
            botonPresionado = false; 
        });

        miCanvas.addEventListener('mousemove', (evento) => {
            if (!botonPresionado) return; 
            
            const rect = miCanvas.getBoundingClientRect();
            const x = evento.clientX - rect.left;
            const y = evento.clientY - rect.top;

            if (x >= 0 && x <= miCanvas.width && y >= 0 && y <= miCanvas.height) {
                puntos.push({ x, y });
                dibujarCanvas();
            }
        });

        function dibujarCanvas() {
            ctx.clearRect(0, 0, miCanvas.width, miCanvas.height);

            formas.forEach(forma => {
                ctx.beginPath();
                if (forma.esCirculo) {
                    ctx.arc(forma.x, forma.y, forma.tamaño / 2, 0, 2 * Math.PI);
                } else {
                    ctx.rect(forma.x - forma.tamaño / 2, forma.y - forma.tamaño / 2, forma.tamaño, forma.tamaño);
                }
                ctx.fillStyle = forma.color;
                ctx.fill();
                ctx.stroke();
            });

            ctx.fillStyle = 'gray'; 
            const radio = 2; 
            puntos.forEach(punto => {
                ctx.beginPath();
                ctx.arc(punto.x, punto.y, radio, 0, 2 * Math.PI);
                ctx.fill();
            });
        }
    </script>
</body>
</html>
